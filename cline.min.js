const ENGAGEMENT_SESSION_LIMIT=1e4;let session_start=null,user_engaged=!1,user_converted=!1,user_bounced=!0,sessionId="",variants={};function swapHTMLContent(e,n){var t;let i=e.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&");if(doesIncludeHTML(e)||doesIncludeHTML(n))setTimeout(()=>{let t=document.createElement("div");t.innerHTML=e;let i=document.createElement("div");i.innerHTML=n;let o=document.createTreeWalker(document.body,NodeFilter.SHOW_ELEMENT,null,!1),r;for(;r=o.nextNode();)r.innerHTML.includes(e)&&modifyElementContent(r,t,i)},0);else{let o=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,null,!1),r=RegExp(i,"g"),a;for(;a=o.nextNode();)a.parentElement&&"script"!==a.parentElement.tagName.toLowerCase()&&(a.textContent=a.textContent.replace(r,n))}}function doesIncludeHTML(e){return/<[a-z][\s\S]*>/i.test(e)}function modifyElementContent(e,n,t){let i=document.createDocumentFragment();for(let o of Array.from(e.childNodes))if(o.nodeType===Node.ELEMENT_NODE&&o.outerHTML.includes(n.innerHTML)){let r=o.outerHTML.replace(n.innerHTML,t.innerHTML),a=document.createElement("div");a.innerHTML=r,i.appendChild(a.firstChild)}else i.appendChild(o);e.textContent="",e.appendChild(i)}async function getExperiment(e,n,t,i){let o=await fetch("https://api.cline.ai/experiment/active/"+e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({time:n,languages:void 0!==t?t.languages||t.language:void 0,platform:void 0!==t?t.platform||t.userAgentData&&t.userAgentData.platform:void 0,referrer:i,url:window.location.href})});return o.json()}async function transmitSessionData(e){let n="https://api.cline.ai/session/"+e.sessionId;try{await fetch(n,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}catch(t){}}function trackEngagement(){let e=new Date-session_start;e>=1e4?(user_engaged=!0,transmitSessionData({engaged:!0,sessionId:sessionId})):setTimeout(trackEngagement,1e4-e)}function trackConversion(e){user_converted=!0,user_bounced=!1,transmitSessionData({converted:!0,sessionId:sessionId,experimentId:e})}function trackBounce(){user_bounced&&transmitSessionData({bounced:!0,sessionId:sessionId})}function checkVisitPageConversion(e){"VISIT_PAGE"===e.type&&(window.location.href===e.conversionUrl||window.location.href===e.conversionUrl+"/")&&trackConversion(e.experimentId)}function checkScrollPageConversion(e){if("SCROLL_PAGE"===e.type&&(window.location.href===e.conversionUrl||window.location.href===e.conversionUrl+"/")){let n=parseFloat(e.conversionScrollPercentage);window.addEventListener("scroll",function(){let t=(window.scrollY+window.innerHeight)/document.documentElement.scrollHeight*100;t>=n&&(trackConversion(e.experimentId),window.removeEventListener("scroll",arguments.callee))})}}function checkClickOnTextConversion(e){"CLICK_ON_TEXT"===e.type&&document.addEventListener("click",function(n){let t=n.target;for(;t;){if(t.textContent.toLowerCase()===e.conversionText.toLowerCase()){trackConversion(e.experimentId),document.removeEventListener("click",arguments.callee);break}t=t.parentElement}})}window.addEventListener("popstate",()=>{if(variants[window.location.href])try{variants[window.location.href].forEach(({original:e,copy:n})=>{swapHTMLContent(e,n)})}catch{}});const VariantApp={};VariantApp.initialize=async function(){var e=window.EXPERIMENT_SITE_ID;session_start=new Date,window.addEventListener("beforeunload",trackBounce),document.addEventListener("visibilitychange",trackEngagement),document.addEventListener("conversion",trackConversion);try{let n=await getExperiment(e,session_start,navigator,document.referrer);if(variants[window.location.href]=n.activeVariants,sessionId=n.sessionId){setTimeout(trackEngagement,1e4),variants[window.location.href].forEach(({original:e,copy:n})=>{swapHTMLContent(e,n)});let t=n.activeVariants.map(e=>e.conversion);t.length>0&&t.forEach(e=>{checkVisitPageConversion(e),checkScrollPageConversion(e),checkClickOnTextConversion(e)})}}catch{}},VariantApp.logVariantConversion=function(){document.dispatchEvent(new CustomEvent("conversion",{}))},"loading"!==document.readyState?VariantApp.initialize():document.addEventListener("DOMContentLoaded",e=>{let n=new Promise((e,n)=>{setTimeout(()=>{e("timeout")},1200)});Promise.race([VariantApp.initialize(),n]).then(e=>{document.body.style.visibility="visible"})}),window.VariantApp=VariantApp;
