const ENGAGEMENT_SESSION_LIMIT=1e4;let session_start=null,user_engaged=!1,user_converted=!1,user_bounced=!0,sessionId="";function swapHTMLContent(a,i){var e=a.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&");if(doesIncludeHTML(a)||doesIncludeHTML(i))setTimeout(()=>{for(var e,n=document.createElement("div"),t=(n.innerHTML=a,document.createElement("div")),o=(t.innerHTML=i,document.createTreeWalker(document.body,NodeFilter.SHOW_ELEMENT,null,!1));e=o.nextNode();)e.innerHTML.includes(a)&&modifyElementContent(e,n,t)},0);else for(var n,t=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,null,!1),o=new RegExp(e,"g");n=t.nextNode();)n.parentElement&&"script"!==n.parentElement.tagName.toLowerCase()&&(n.textContent=n.textContent.replace(o,i))}function doesIncludeHTML(e){return/<[a-z][\s\S]*>/i.test(e)}function modifyElementContent(e,n,t){var o,a,i=document.createDocumentFragment();for(const s of Array.from(e.childNodes))s.nodeType===Node.ELEMENT_NODE&&s.outerHTML.includes(n.innerHTML)?(o=s.outerHTML.replace(n.innerHTML,t.innerHTML),(a=document.createElement("div")).innerHTML=o,i.appendChild(a.firstChild)):i.appendChild(s);e.textContent="",e.appendChild(i)}async function getExperiment(e,n,t,o){return(await fetch("https://api.client.ai/experiment/active-variants/"+e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({time:n,languages:void 0!==t?t.languages||t.language:void 0,platform:void 0!==t?t.platform||t.userAgentData&&t.userAgentData.platform:void 0,referrer:o})})).json()}async function transmitSessionData(e){var n="https://api.client.ai/session/"+e.sessionId;try{var t=await fetch(n,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return console.log("Session data sent: ",e),t.json()}catch(e){console.error("An error occurred while sending data:",e)}}function trackEngagement(){var e=new Date-session_start;e>=ENGAGEMENT_SESSION_LIMIT?transmitSessionData({engaged:user_engaged=!0,sessionId:sessionId}):setTimeout(trackEngagement,ENGAGEMENT_SESSION_LIMIT-e)}function trackConversion(){user_converted=!0,transmitSessionData({converted:!(user_bounced=!1),sessionId:sessionId})}function trackBounce(){user_bounced&&transmitSessionData({bounced:!0,sessionId:sessionId})}const VariantApp={initialize:async function(){var e=window.EXPERIMENT_PAGE_ID,e=(session_start=new Date,window.addEventListener("beforeunload",trackBounce),document.addEventListener("visibilitychange",trackEngagement),document.addEventListener("conversion",trackConversion),setTimeout(trackEngagement,ENGAGEMENT_SESSION_LIMIT),await getExperiment(e,session_start,navigator,document.referrer)),n=e.activeVariants;sessionId=e.sessionId;try{n.forEach(({original:e,copy:n})=>{console.log("Replacing: ",e," with: ",n),swapHTMLContent(e,n)})}catch{}},logVariantConversion:function(){document.dispatchEvent(new CustomEvent("conversion",{}))}};(window.VariantApp=VariantApp).initialize();
